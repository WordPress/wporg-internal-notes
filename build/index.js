!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=10)}([function(e,t){e.exports=window.wp.element},function(e,t){e.exports=window.wp.data},function(e,t){e.exports=window.wp.components},function(e,t){e.exports=window.wp.i18n},function(e,t){e.exports=window.wp.dataControls},function(e,t,n){var r;!function(){"use strict";var n={}.hasOwnProperty;function o(){for(var e=[],t=0;t<arguments.length;t++){var r=arguments[t];if(r){var s=typeof r;if("string"===s||"number"===s)e.push(r);else if(Array.isArray(r)){if(r.length){var a=o.apply(null,r);a&&e.push(a)}}else if("object"===s)if(r.toString===Object.prototype.toString)for(var c in r)n.call(r,c)&&r[c]&&e.push(c);else e.push(r.toString())}}return e.join(" ")}e.exports?(o.default=o,e.exports=o):void 0===(r=function(){return o}.apply(t,[]))||(e.exports=r)}()},function(e,t){e.exports=window.wp.plugins},function(e,t){e.exports=window.wp.editPost},function(e,t){e.exports=window.wp.url},function(e,t){e.exports=window.wp.compose},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"createNote",(function(){return T})),n.d(r,"clearIsCreated",(function(){return S})),n.d(r,"deleteNote",(function(){return v})),n.d(r,"setIsDeleted",(function(){return y})),n.d(r,"setNotes",(function(){return C})),n.d(r,"appendNotes",(function(){return D}));var o={};n.r(o),n.d(o,"getNotes",(function(){return k}));var s={};n.r(s),n.d(s,"getNotes",(function(){return B})),n.d(s,"getCurrentNotesCount",(function(){return F})),n.d(s,"getTotalNotesCount",(function(){return M})),n.d(s,"isCreated",(function(){return q})),n.d(s,"isDeleted",(function(){return $}));var a=n(0),c=n(6),l=n(2),i=n(1),u=n(7),d=n(3),p=n(4);const E={CREATE_NOTE:"CREATE_NOTE",DELETE_NOTE:"DELETE_NOTE",SET_NOTES:"SET_NOTES",APPEND_NOTES:"APPEND_NOTES",CLEAR_IS_CREATED:"CLEAR_IS_CREATED",SET_IS_DELETED:"SET_IS_DELETED"};var b=n(8);const m=({noteId:e,queryArgs:t=[]})=>{const n=Object(i.select)("core/editor").getCurrentPostId(),r=Object(i.select)("core/editor").getCurrentPostType(),{rest_base:o}=Object(i.select)("core").getPostType(r);let s=`/wp/v2/${o}/${n}/internal-notes`;return e&&(s+="/"+e),Object(b.addQueryArgs)(s,t)};function*_(e=0){const t={_embed:!0,context:"edit",per_page:10,offset:e},n=yield Object(p.apiFetch)({path:m({queryArgs:t}),parse:!1}),r=yield Object(p.__unstableAwaitPromise)((async e=>{var t;return{totalNotes:Number((null===(t=e.headers)||void 0===t?void 0:t.get("X-WP-Total"))||0),notes:await e.json()}})(n));if(r)return r}const{CREATE_NOTE:f,DELETE_NOTE:O,SET_NOTES:g,APPEND_NOTES:j,CLEAR_IS_CREATED:N,SET_IS_DELETED:w}=E;function*T(e){const t=yield Object(p.apiFetch)({path:m({queryArgs:{_embed:!0,context:"edit"}}),method:"POST",data:e});if(t)return{type:f,note:t}}const S=e=>({type:N,noteId:e});function*v(e){if(yield Object(p.apiFetch)({path:m({noteId:e}),method:"DELETE"}))return{type:O,noteId:e}}const y=e=>({type:w,noteId:e});function*C(){const{totalNotes:e,notes:t}=yield _();return{type:g,totalNotes:e,notes:t}}function*D(e){const{totalNotes:t,notes:n}=yield _(e);return{type:j,totalNotes:t,notes:n}}const{CREATE_NOTE:h,DELETE_NOTE:x,SET_NOTES:P,APPEND_NOTES:A,CLEAR_IS_CREATED:I,SET_IS_DELETED:L}=E,R={totalNotes:0,notes:[],isCreated:[],isDeleted:[]};function*k(){yield C()}function B(e){return e.notes||[]}function F(e){return e.notes.length}function M(e){return e.totalNotes}function q(e,t){return e.isCreated.includes(t)}function $(e,t){return e.isDeleted.includes(t)}const H=Object(i.createReduxStore)("wporg/internal-notes",{actions:r,controls:p.controls,selectors:s,resolvers:o,reducer:(e=R,{note:t,notes:n,noteId:r,totalNotes:o,type:s})=>{switch(s){case h:return{...e,totalNotes:e.totalNotes+1,notes:[t,...e.notes],isCreated:[...e.isCreated,t.id]};case I:return{...e,isCreated:[...e.isCreated].filter(e=>e!==r)};case x:return{...e,totalNotes:e.totalNotes-1,notes:[...e.notes].filter(e=>e.id!==r),isDeleted:[...e.isDeleted].filter(e=>e!==r)};case L:return{...e,isDeleted:[...e.isDeleted,r]};case P:return{...e,totalNotes:o,notes:n};case A:const s=n.map(e=>e.id);return{...e,totalNotes:o,notes:[...e.notes,...n],isCreated:[...e.isCreated,...s]};default:return e}}});Object(i.register)(H);const Q=()=>{const[e,t]=Object(a.useState)(!1),n=Object(i.useSelect)(e=>{const{getCurrentNotesCount:t,getTotalNotesCount:n}=e(H);return{current:t(),total:n()}}),{appendNotes:r,clearIsCreated:o}=Object(i.useDispatch)(H);return Object(a.createElement)(a.Fragment,null,n.total>n.current&&Object(a.createElement)(l.PanelBody,{className:"load-more"},Object(a.createElement)(a.Fragment,null,e&&Object(a.createElement)(l.Spinner,null),!e&&Object(a.createElement)(l.Button,{className:"wporg-internal-notes__button-load-more",text:Object(d.__)("Load older notes","wporg"),isSecondary:!0,onClick:()=>{t(!0),r(n.current).then(({notes:e})=>{setTimeout(()=>{e.forEach(e=>{o(e.id)}),t(!1)},300)})}}))))},W=()=>{const[e,t]=Object(a.useState)(!1),[n,r]=Object(a.useState)(!1),[o,s]=Object(a.useState)(""),{clearIsCreated:c,createNote:u}=Object(i.useDispatch)(H);return Object(a.createElement)(l.PanelBody,{className:"wporg-internal-notes__note-form"},e&&Object(a.createElement)(a.Fragment,null,Object(a.createElement)(l.TextareaControl,{className:"wporg-internal-notes__note-form-textarea",label:Object(d.__)("Add a note","wporg"),value:o,onChange:e=>s(e),rows:"2",disabled:n}),Object(a.createElement)("div",{className:"wporg-internal-notes__note-form-buttons"},n&&Object(a.createElement)(l.Spinner,null),!n&&Object(a.createElement)(a.Fragment,null,Object(a.createElement)(l.Button,{className:"wporg-internal-notes__note-form-button-cancel",text:Object(d.__)("Cancel","wporg"),onClick:e=>{e.preventDefault(),t(!1)},isSecondary:!0}),Object(a.createElement)(l.Button,{className:"wporg-internal-notes__note-form-button-submit",text:Object(d.__)("Submit","wporg"),onClick:()=>{o.length&&(r(!0),u({excerpt:o}).then(({note:e})=>{s(""),r(!1),setTimeout(()=>{c(e.id)},300)}))},isPrimary:!0})))),!e&&Object(a.createElement)(l.Button,{className:"wporg-internal-notes__note-form-button-toggle",text:Object(d.__)("Add a note","wporg"),onClick:()=>{t(!0)},isPrimary:!0}))};var X=n(5),z=n.n(X),G=n(9);const J=({noteId:e})=>{const[t,n]=Object(a.useState)(!1),{deleteNote:r,setIsDeleted:o}=Object(i.useDispatch)(H),s=Object(G.useRefEffect)(e=>{const{ownerDocument:t}=e,r=t=>{e&&!e.contains(t.target)&&n(!1)};return t.addEventListener("mousedown",r),()=>{t.removeEventListener("mousedown",r)}},[]);return Object(a.createElement)(a.Fragment,null,!t&&Object(a.createElement)(l.Button,{className:"wporg-internal-notes__note-button-delete",label:Object(d.__)("Delete note","wporg"),icon:"trash",isSecondary:!0,onClick:()=>{n(!0)}}),t&&Object(a.createElement)(l.Button,{ref:s,className:"wporg-internal-notes__note-button-confirm-delete",isDestructive:!0,onClick:()=>{o(e),setTimeout(()=>{r(e)},300)}},Object(d.__)("Delete this note?","wporg")))},K=({className:e,note:t})=>{var n,r,o,s;const{id:c,date_gmt:l,date_relative:u}=t,p=null==t||null===(n=t._embedded)||void 0===n||null===(r=n.author)||void 0===r?void 0:r[0],E=(null==p||null===(o=p.avatar_urls)||void 0===o?void 0:o[24])||"",b=(null==p?void 0:p.slug)||"unknown",m=null==t||null===(s=t.excerpt)||void 0===s?void 0:s.rendered,{isCreated:_,isDeleted:f}=Object(i.useSelect)(e=>{const{isCreated:n,isDeleted:r}=e(H);return{isCreated:n(t.id),isDeleted:r(t.id)}},[t]);if(!u||!m)return Object(a.createElement)("li",{className:z()("wporg-internal-notes__note","is-error",e)},Object(d.__)("Missing data.","wporg"));const O=z()("wporg-internal-notes__note",{"is-created":_,"is-deleted":f},e);return Object(a.createElement)("li",{className:O},Object(a.createElement)("header",{className:"wporg-internal-notes__note-header"},Object(a.createElement)("div",null,Object(a.createElement)("div",{className:"wporg-internal-notes__note-author"},E&&Object(a.createElement)("img",{className:"wporg-internal-notes__note-author-avatar",src:E,alt:""}),Object(a.createElement)("a",{className:"wporg-internal-notes__note-author-name",href:Object(d.sprintf)("https://profiles.wordpress.org/%s",b)},Object(d.sprintf)("@%s",b))),Object(a.createElement)("time",{className:"wporg-internal-notes__note-date",title:l,dateTime:l},u)),Object(a.createElement)(J,{noteId:c})),Object(a.createElement)(a.RawHTML,{className:"wporg-internal-notes__note-excerpt"},m))},U=({notes:e})=>Object(a.createElement)("ul",{className:"wporg-internal-notes__notes-list"},e.map(e=>Object(a.createElement)(K,{key:e.id,note:e}))),V=()=>{const{getTotalNotesCount:e}=Object(i.useSelect)(e=>e(H));return Object(a.createElement)("div",{className:"wporg-internal-notes__sidebar-icon"},Object(a.createElement)("span",{className:"note-count"},e().toLocaleString()),Object(a.createElement)(l.Icon,{icon:"edit-page"}))},Y=()=>{const e=Object(i.useSelect)(e=>e(H).getNotes());return Object(a.createElement)(u.PluginSidebar,{name:"wporg-internal-notes__sidebar",className:"wporg-internal-notes__sidebar",title:Object(d.__)("Internal Notes","wporg"),icon:Object(a.createElement)(V,null)},Object(a.createElement)(W,null),Object(a.createElement)(U,{notes:e}),Object(a.createElement)(Q,null))};Object(c.registerPlugin)("wporg-internal-notes",{render:()=>Object(a.createElement)(Y,null)})}]);
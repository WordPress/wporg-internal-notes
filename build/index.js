!function(){var e={472:function(e,t){var n;!function(){"use strict";var r={}.hasOwnProperty;function o(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(n){var s=typeof n;if("string"===s||"number"===s)e.push(n);else if(Array.isArray(n)){if(n.length){var a=o.apply(null,n);a&&e.push(a)}}else if("object"===s)if(n.toString===Object.prototype.toString)for(var l in n)r.call(n,l)&&n[l]&&e.push(l);else e.push(n.toString())}}return e.join(" ")}e.exports?(o.default=o,e.exports=o):void 0===(n=function(){return o}.apply(t,[]))||(e.exports=n)}()}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){"use strict";var e={};n.r(e),n.d(e,{appendNotes:function(){return h},clearIsCreated:function(){return S},createNote:function(){return v},deleteNote:function(){return C},setIsDeleted:function(){return y},setNotes:function(){return D}});var t={};n.r(t),n.d(t,{getNotes:function(){return R}});var r={};n.r(r),n.d(r,{getCurrentNotesCount:function(){return k},getNotes:function(){return j},getTotalNotesCount:function(){return B},isCreated:function(){return F},isDeleted:function(){return M}});var o=window.wp.element,s=window.wp.plugins,a=window.wp.components,l=window.wp.data,i=window.wp.editPost,c=window.wp.i18n,u=window.wp.dataControls;const d={CREATE_NOTE:"CREATE_NOTE",DELETE_NOTE:"DELETE_NOTE",SET_NOTES:"SET_NOTES",APPEND_NOTES:"APPEND_NOTES",CLEAR_IS_CREATED:"CLEAR_IS_CREATED",SET_IS_DELETED:"SET_IS_DELETED"};var E=window.wp.url;const p=e=>{let{noteId:t,queryArgs:n=[]}=e;const r=(0,l.select)("core/editor").getCurrentPostId(),o=(0,l.select)("core/editor").getCurrentPostType(),{rest_base:s}=(0,l.select)("core").getPostType(o);let a=`/wp/v2/${s}/${r}/internal-notes`;return t&&(a+=`/${t}`),(0,E.addQueryArgs)(a,n)};function*m(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t={_embed:!0,context:"edit",per_page:10,offset:e},n=yield(0,u.apiFetch)({path:p({queryArgs:t}),parse:!1}),r=async e=>{var t;return{totalNotes:Number((null===(t=e.headers)||void 0===t?void 0:t.get("X-WP-Total"))||0),notes:await e.json()}},o=yield(0,u.__unstableAwaitPromise)(r(n));if(o)return o}const{CREATE_NOTE:_,DELETE_NOTE:g,SET_NOTES:f,APPEND_NOTES:N,CLEAR_IS_CREATED:w,SET_IS_DELETED:T}=d;function*v(e){const t=yield(0,u.apiFetch)({path:p({queryArgs:{_embed:!0,context:"edit"}}),method:"POST",data:e});if(t)return{type:_,note:t}}const S=e=>({type:w,noteId:e});function*C(e){if(yield(0,u.apiFetch)({path:p({noteId:e}),method:"DELETE"}))return{type:g,noteId:e}}const y=e=>({type:T,noteId:e});function*D(){const{totalNotes:e,notes:t}=yield m();return{type:f,totalNotes:e,notes:t}}function*h(e){const{totalNotes:t,notes:n}=yield m(e);return{type:N,totalNotes:t,notes:n}}const{CREATE_NOTE:b,DELETE_NOTE:P,SET_NOTES:A,APPEND_NOTES:I,CLEAR_IS_CREATED:O,SET_IS_DELETED:x}=d,L={totalNotes:0,notes:[],isCreated:[],isDeleted:[]};function*R(){yield D()}function j(e){return e.notes||[]}function k(e){return e.notes.length}function B(e){return e.totalNotes}function F(e,t){return e.isCreated.includes(t)}function M(e,t){return e.isDeleted.includes(t)}const q=(0,l.createReduxStore)("wporg/internal-notes",{actions:e,controls:u.controls,selectors:r,resolvers:t,reducer:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L,{note:t,notes:n,noteId:r,totalNotes:o,type:s}=arguments.length>1?arguments[1]:void 0;switch(s){case b:return{...e,totalNotes:e.totalNotes+1,notes:[t,...e.notes],isCreated:[...e.isCreated,t.id]};case O:return{...e,isCreated:[...e.isCreated].filter((e=>e!==r))};case P:return{...e,totalNotes:e.totalNotes-1,notes:[...e.notes].filter((e=>e.id!==r)),isDeleted:[...e.isDeleted].filter((e=>e!==r))};case x:return{...e,isDeleted:[...e.isDeleted,r]};case A:return{...e,totalNotes:o,notes:n};case I:const s=n.map((e=>e.id));return{...e,totalNotes:o,notes:[...e.notes,...n],isCreated:[...e.isCreated,...s]};default:return e}}});(0,l.register)(q);const $=()=>{const[e,t]=(0,o.useState)(!1),n=(0,l.useSelect)((e=>{const{getCurrentNotesCount:t,getTotalNotesCount:n}=e(q);return{current:t(),total:n()}})),{appendNotes:r,clearIsCreated:s}=(0,l.useDispatch)(q);return(0,o.createElement)(o.Fragment,null,n.total>n.current&&(0,o.createElement)(a.PanelBody,{className:"load-more"},(0,o.createElement)(o.Fragment,null,e&&(0,o.createElement)(a.Spinner,null),!e&&(0,o.createElement)(a.Button,{className:"wporg-internal-notes__button-load-more",text:(0,c.__)("Load older notes","wporg"),isSecondary:!0,onClick:()=>{t(!0),r(n.current).then((e=>{let{notes:n}=e;setTimeout((()=>{n.forEach((e=>{s(e.id)})),t(!1)}),300)}))}}))))},H=()=>{const[e,t]=(0,o.useState)(!1),[n,r]=(0,o.useState)(!1),[s,i]=(0,o.useState)(""),{clearIsCreated:u,createNote:d}=(0,l.useDispatch)(q);return(0,o.createElement)(a.PanelBody,{className:"wporg-internal-notes__note-form"},e&&(0,o.createElement)(o.Fragment,null,(0,o.createElement)(a.TextareaControl,{className:"wporg-internal-notes__note-form-textarea",label:(0,c.__)("Add a note","wporg"),value:s,onChange:e=>i(e),rows:"2",disabled:n}),(0,o.createElement)("div",{className:"wporg-internal-notes__note-form-buttons"},n&&(0,o.createElement)(a.Spinner,null),!n&&(0,o.createElement)(o.Fragment,null,(0,o.createElement)(a.Button,{className:"wporg-internal-notes__note-form-button-cancel",text:(0,c.__)("Cancel","wporg"),onClick:e=>{e.preventDefault(),t(!1)},isSecondary:!0}),(0,o.createElement)(a.Button,{className:"wporg-internal-notes__note-form-button-submit",text:(0,c.__)("Submit","wporg"),onClick:()=>{s.length&&(r(!0),d({excerpt:s}).then((e=>{let{note:t}=e;i(""),r(!1),setTimeout((()=>{u(t.id)}),300)})))},isPrimary:!0})))),!e&&(0,o.createElement)(a.Button,{className:"wporg-internal-notes__note-form-button-toggle",text:(0,c.__)("Add a note","wporg"),onClick:()=>{t(!0)},isPrimary:!0}))};var Q=n(472),W=n.n(Q),X=window.wp.compose;const z=e=>{let{noteId:t}=e;const[n,r]=(0,o.useState)(!1),{deleteNote:s,setIsDeleted:i}=(0,l.useDispatch)(q),u=(0,X.useRefEffect)((e=>{const{ownerDocument:t}=e,n=t=>{e&&!e.contains(t.target)&&r(!1)};return t.addEventListener("mousedown",n),()=>{t.removeEventListener("mousedown",n)}}),[]);return(0,o.createElement)(o.Fragment,null,!n&&(0,o.createElement)(a.Button,{className:"wporg-internal-notes__note-button-delete",label:(0,c.__)("Delete note","wporg"),icon:"trash",isSecondary:!0,onClick:()=>{r(!0)}}),n&&(0,o.createElement)(a.Button,{ref:u,className:"wporg-internal-notes__note-button-confirm-delete",isDestructive:!0,onClick:()=>{i(t),setTimeout((()=>{s(t)}),300)}},(0,c.__)("Delete this note?","wporg")))},G=e=>{var t,n,r,s;let{className:a,note:i}=e;const{id:u,date_gmt:d,date_relative:E}=i,p=null==i||null===(t=i._embedded)||void 0===t||null===(n=t.author)||void 0===n?void 0:n[0],m=(null==p||null===(r=p.avatar_urls)||void 0===r?void 0:r[24])||"",_=(null==p?void 0:p.slug)||"unknown",g=null==i||null===(s=i.excerpt)||void 0===s?void 0:s.rendered,{isCreated:f,isDeleted:N}=(0,l.useSelect)((e=>{const{isCreated:t,isDeleted:n}=e(q);return{isCreated:t(i.id),isDeleted:n(i.id)}}),[i]);if(!E||!g)return(0,o.createElement)("li",{className:W()("wporg-internal-notes__note","is-error",a)},(0,c.__)("Missing data.","wporg"));const w=W()("wporg-internal-notes__note",{"is-created":f,"is-deleted":N},a);return(0,o.createElement)("li",{className:w},(0,o.createElement)("header",{className:"wporg-internal-notes__note-header"},(0,o.createElement)("div",null,(0,o.createElement)("div",{className:"wporg-internal-notes__note-author"},m&&(0,o.createElement)("img",{className:"wporg-internal-notes__note-author-avatar",src:m,alt:""}),(0,o.createElement)("a",{className:"wporg-internal-notes__note-author-name",href:(0,c.sprintf)("https://profiles.wordpress.org/%s",_)},(0,c.sprintf)("@%s",_))),(0,o.createElement)("time",{className:"wporg-internal-notes__note-date",title:d,dateTime:d},E)),(0,o.createElement)(z,{noteId:u})),(0,o.createElement)(o.RawHTML,{className:"wporg-internal-notes__note-excerpt"},g))},J=e=>{let{notes:t}=e;return(0,o.createElement)("ul",{className:"wporg-internal-notes__notes-list"},t.map((e=>(0,o.createElement)(G,{key:e.id,note:e}))))},K=()=>{const{getTotalNotesCount:e}=(0,l.useSelect)((e=>e(q)));return(0,o.createElement)("div",{className:"wporg-internal-notes__sidebar-icon"},(0,o.createElement)("span",{className:"note-count"},e().toLocaleString()),(0,o.createElement)(a.Icon,{icon:"edit-page"}))},U=()=>{const e=(0,l.useSelect)((e=>e(q).getNotes()));return(0,o.createElement)(i.PluginSidebar,{name:"wporg-internal-notes__sidebar",className:"wporg-internal-notes__sidebar",title:(0,c.__)("Internal Notes","wporg"),icon:(0,o.createElement)(K,null)},(0,o.createElement)(H,null),(0,o.createElement)(J,{notes:e}),(0,o.createElement)($,null))};(0,s.registerPlugin)("wporg-internal-notes",{render:()=>(0,o.createElement)(U,null)})}()}();